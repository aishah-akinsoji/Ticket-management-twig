<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="public/style.css">
        <script src="https://kit.fontawesome.com/ad69c05094.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <title>{% block title %}Ticket Management system built with twig {% endblock %}</title>
    </head>
    <body>
        {% include 'toast.twig' %}

        <div class="ticket-management">
      <header class='navbar navbar-expand-lg'>
        <div class='container'>
          <div class='d-flex justify-content-between align-items-center w-100'>
            <div class='logo'>
              <img src='public/fixMate-logo-transparent.png' alt="FixMate Logo"/>
            </div>
            <div class='d-flex gap-3'>
              <button class='coloured-btn' type="button" onclick="window.location.href='index.php?page=dashboard'">Go to Dashboard</button>
              <button class='logout rounded-3' type="button" onclick="window.location.href='index.php?logout=1'">
                Logout
              </button>
            </div>
          </div>
        </div>
      </header>
      <main class='tickets d-flex justify-content-center'>
        <div class='container d-flex flex-column align-items-center gap-3'>
          <button id="newTicket" class="coloured-btn" type="button">
            <i class="fa-solid fa-plus"></i> Create a new ticket
          </button>
            {% if tickets is empty %}
                <div class="no-tickets d-flex flex-column justify-content-center align-items-center h1 mt-4">
                    <i class="fa-solid fa-ticket"></i>
                    <p>No tickets available</p>
                </div>
            {% else %}
                <div class='row gap-3 py-4 align-items-center justify-content-center w-100'>
                {% for ticket in tickets %}
                    <div class='col-sm-12 col-md-4 border-0 card p-3 shadow-lg rounded-4 d-flex flex-column gap-2'>
                        <div class='d-flex justify-content-between align-items-center'>
                            <h5>{{ ticket.title }}</h5>
                            <div class="d-flex gap-2">
                            <button class="ticket-btn"><i class="fa-solid fa-pen-to-square"></i></button>
                            <button class="ticket-btn"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                        <p>{{ ticket.description }}</p>
                        <div class='d-flex justify-content-between'>
                            <span class="ticket-status p-1 rounded-3" 
                                  style="background-color: 
                                  {% if ticket.status == 'Open' %}
                                      rgba(0, 109, 0, 0.363)
                                  {% elseif ticket.status == 'In Progress' %}
                                      rgba(255, 166, 0, 0.473)
                                  {% else %}
                                      rgba(128, 128, 128, 0.336)
                                  {% endif %}">
                                {{ ticket.status }}
                            </span>
                            <span class="ticket-priority p-1 rounded-3" 
                                  style="background-color: 
                                  {% if ticket.priority == 'Low' %}
                                      rgba(131, 139, 131, 0.36)
                                  {% elseif ticket.priority == 'Medium' %}
                                      rgba(0, 119, 255, 0.47)
                                  {% else %}
                                      rgba(255, 0, 0, 0.34)
                                  {% endif %}">
                                {{ ticket.priority }}
                            </span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
      </main>
      <div id="modalBox" class="modal-box-container">
        <div class="modal-box">
        <div class="modal-box-header">
            <div class="modal-box-title">
                <h1>{{ editingTicket ? "Edit Ticket" : "Create new ticket" }}</h1>
                <p class="small fw-normal">Fill in the details below.</p>
            </div>
        </div>
        <div class="modal-box-body">
            <form class="d-flex flex-column gap-3">
                <div class="title d-flex flex-column">
                <label for="title" class="fw-bold" required>Title *</label>
                <input id="title" type="text" placeholder="Title" required/>
                <span style="color: red;">{{ errors.title }}</span>
                </div>
                <div class="description d-flex flex-column">
                <label for="description" class="fw-bold">Description *</label>
                <textarea id="description" placeholder="Description" required></textarea>
                <span style="color: red;">{{ errors.description }}</span>
                </div>
                <div class="status d-flex flex-column">
                <label class="fw-bold">Status *</label>
                <select>
                    <option value="Open">Open</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Resolved">Resolved</option>
                </select>
                </div>
                <div class="priority d-flex flex-column">
                <label class="fw-bold">Priority</label>
                <select>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
                </div>
            </form>
        </div>
        <div class="modal-box-footer">
            <button id="closeModal" color="secondary">Close</button>
            <button class="coloured-btn">
                {{ editingTicket ? "Update Ticket" : "Create Ticket" }}
            </button>
        </div>
      </div>

      </div>
      {% include 'footer.twig' %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="public/script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const closeModal = document.getElementById("closeModal");
            const modalBox = document.getElementById("modalBox");
            const newTicket = document.getElementById("newTicket")
            closeModal.addEventListener("click", () => {
                modalBox.style.display = "none";
                modalBox.style.pointerEvent = "none"
            })
            newTicket.addEventListener("click", () => {
                modalBox.style.display = "flex";
                modalBox.style.pointerEvent = "auto"
            })
        })
    </script>
    </body>
</html>
